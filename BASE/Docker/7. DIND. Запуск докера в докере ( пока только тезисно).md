ТЕЗИСЫ


https://devops-courses.zone3000.net/kak-zapustit-doker-vnutri-dokera/

https://habr.com/ru/articles/477464/

все dind  запускаются с docker run --privileged
1)CAP_SYS_ADMIN: В привилегированном режиме контейнер получает способность выполнять системные вызовы
2)setns системный вызов : Docker может использовать его  для установки пространств имен контейнера.
-и  другие системные вызовы (к ядру)

 с привилегированным доступом Docker  получает полный доступ к хостовой системе(не эквивалентно пробросу сокета)

docker run -it -v /var/run/docker.sock:/var/run/docker.sock [my-image-that-has-docker] docker ps

 в контейнере докер хочет обращаться к серверу Docker через сокс-сервер. который надо пробросить в этот изолированный контейнер
 
для установления коммуникации между Docker демоном и Docker клиентом. Этот сокет представляет UNIX-сокет, который позволяет взаимодействовать с Docker API.
Docker-демон и Docker-клиент обычно работают на уровне хост-системы и не могут быть запущены внутри контейнера в обычном режиме.

 Демон внутри контейнера не сможет подкрасться к ядру хост-системы для управления контейнерами. 
 
есть ещё sysbox такая тема. пишут что работает вообще без всего и без priveleged.  но как обычно... пока не проверишь))

Sysbox в качестве исполняющей среды.
docker run --runtime=sysbox-runc -it --rm your_image


-----------------------------------------------------------------------------------
Docker предназначен для управления и запуска контейнеров на хост-системе, и обычно Docker-демон (или Docker-сервер) работает на уровне хоста. Docker-клиент взаимодействует с Docker-демоном через API Docker. Это означает, что Docker-демон и Docker-клиент обычно работают на уровне хост-системы и не могут быть запущены внутри контейнера в обычном режиме.

Если вы попытаетесь запустить Docker-демон внутри контейнера, вы столкнетесь с несколькими проблемами:

Проблемы с доступом к ядру хост-системы: Docker-демон требует доступа к ядру хост-системы, чтобы управлять контейнерами. Контейнеры построены на изоляции, и обеспечивают изоляцию процессов внутри контейнера от хост-системы. Запуск Docker-демона внутри контейнера не даст ему необходимого доступа к ядру.

Управление контейнерами: Если Docker-демон будет работать внутри контейера, он будет пытаться управлять контейнерами, включая сам контейнер, в котором он работает. Это может привести к конфликтам и нежелательному поведению.

Использование ресурсов: Docker-демон обычно использует значительное количество ресурсов, и запуск его внутри контейнера может привести к неэффективному использованию ресурсов хост-системы.

Вместо запуска Docker-демона внутри контейнера, вы обычно запускаете Docker-клиент в контейнере. Этот клиент может взаимодействовать с Docker-демоном на хост-системе через сокс-сокет или сетевое соединение, что позволяет управлять контейнерами на хост-системе изнутри контейнера. Этот подход гораздо более безопасен и эффективен, чем попытка запуска Docker-демона внутри контейнера.
